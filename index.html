<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced Range Input Component</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" />
    <style>
        /* A demonstration of styling the web component using CSS Parts */
        range-group {
            /* These are custom properties the component uses internally */
            /*--track-height: 8px;*/
            /*--thumb-size: 28px;*/
            /*--thumb-bg: oklch(70% 0.28 260); !* Bright Indigo *!*/
            /*--tick-color: oklch(60% 0.02 230);*/
            /*--tick-label-color: oklch(70% 0.02 230);*/

            /* General component styling */
            width: 100%;
            display: block;
        }

        /* Styling the component parts from the outside */
        range-group::part(track) {
            background-color: oklch(25% 0.02 230);
            border-radius: 9999px;
        }

        range-group::part(thumb) {
            border: 2px solid oklch(95% 0.01 230);
            border-radius: 50%;
        }
    </style>
</head>
<body>
<div class="container-wrapper">
    <div class="main-container">
        <header class="header">
            <h1>The Future of Range Inputs</h1>
            <p class="subtitle">
                A Lit web component implementation of the proposed <code>&lt;rangegroup&gt;</code> element.
                <a href="https://open-ui.org/components/enhanced-range-input.explainer/" target="_blank">Read the rangegroup explainer</a>
            </p>
        </header>

        <div class="sections-container">
            <!-- Examples will be dynamically loaded here -->
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
<script type="module">
    import "./src/range-group.ts";

    /**
     * This function contains all the logic from the old script block
     * that sets up event listeners for the interactive examples. It's called
     * after the example HTML has been loaded into the DOM.
     */
    function initializeInteractiveExamples() {
        // --- Interactive Price Range Example ---
        const priceRange = document.getElementById("interactive-price-range");
        const minPriceInput = document.getElementById("price-min-num-input");
        const maxPriceInput = document.getElementById("price-max-num-input");

        if (priceRange && minPriceInput && maxPriceInput) {
            const syncInputsToSlider = () => {
                const [minVal, maxVal] = priceRange.values.map((v) => Math.round(v));
                minPriceInput.value = minVal;
                maxPriceInput.value = maxVal;
                minPriceInput.max = maxVal;
                maxPriceInput.min = minVal;
            };

            minPriceInput.addEventListener("input", () => {
                let value = parseInt(minPriceInput.value, 10);
                if (isNaN(value)) return;
                priceRange.setRangeValue(0, value);
                syncInputsToSlider(); // Re-sync to handle clamping
            });

            maxPriceInput.addEventListener("input", () => {
                let value = parseInt(maxPriceInput.value, 10);
                if (isNaN(value)) return;
                priceRange.setRangeValue(1, value);
                syncInputsToSlider(); // Re-sync to handle clamping
            });

            priceRange.addEventListener("change", syncInputsToSlider);
            syncInputsToSlider(); // Initial sync
        }

        // --- Budget Allocator Example ---
        const budgetRange = document.getElementById("budget-range");
        const budgetLabels = [
            document.getElementById("budget-label-0"),
            document.getElementById("budget-label-1"),
            document.getElementById("budget-label-2"),
            document.getElementById("budget-label-3"),
        ].filter(l => l); // Filter out nulls just in case
        const budgetCategories = ["Groceries", "Rent", "Transport", "Internet"];

        if (budgetRange && budgetLabels.length === 4) {
            const updateBudgetLabels = () => {
                // Replicate the component's internal value-to-percent logic
                const valueToPercent = (value) => {
                    const min = Number(budgetRange.min);
                    const max = Number(budgetRange.max);
                    // Prevent division by zero if min and max are the same
                    if (max === min) return 0;
                    return ((value - min) / (max - min)) * 100;
                };

                const values = [0, ...budgetRange.values, 100];
                for (let i = 0; i < budgetLabels.length; i++) {
                    const start = values[i];
                    const end = values[i + 1];
                    const percentage = Math.round(end - start);
                    const midPoint = start + (end - start) / 2;
                    const midPercent = valueToPercent(midPoint);

                    // Position the label at the midpoint of its segment
                    budgetLabels[i].style.left = `${midPercent}%`;
                    budgetLabels[i].innerHTML = `<strong>${budgetCategories[i]}</strong><br>${percentage}%`;
                }
            };
            updateBudgetLabels();
            budgetRange.addEventListener("change", updateBudgetLabels);
        }

        // --- Floating Tooltip Example ---
        const floatingRange = document.getElementById("floating-tooltip-range");
        const floatingTooltip1 = document.getElementById("floating-tooltip-1");
        const floatingTooltip2 = document.getElementById("floating-tooltip-2");

        if (floatingRange && floatingTooltip1 && floatingTooltip2) {
            const tooltips = [floatingTooltip1, floatingTooltip2];
            const updateFloatingTooltips = () => {
                const values = floatingRange.values;
                if (values && values.length >= 2) {
                    tooltips[0].textContent = Math.round(values[0]);
                    tooltips[1].textContent = Math.round(values[1]);
                }
            };
            updateFloatingTooltips();
            floatingRange.addEventListener("change", updateFloatingTooltips);
        }

        // --- Classic Tooltip Example ---
        const classicRange = document.getElementById("classic-range");
        const classicTooltip1 = document.getElementById("classic-tooltip-1");
        const classicTooltip2 = document.getElementById("classic-tooltip-2");

        if (classicRange && classicTooltip1 && classicTooltip2) {
            const updateClassicTooltips = () => {
                const values = classicRange.values;
                classicTooltip1.textContent = Math.round(values[0]);
                classicTooltip2.textContent = Math.round(values[1]);
            };
            updateClassicTooltips();
            classicRange.addEventListener("change", updateClassicTooltips);
        }

        // --- API Example ---
        const apiRange = document.getElementById("api-range");
        const getValuesBtn = document.getElementById("getValuesBtn");
        const setValuesBtn = document.getElementById("setValuesBtn");
        const apiOutput = document.getElementById("apiOutput");

        if (apiRange && getValuesBtn && setValuesBtn && apiOutput) {
            getValuesBtn.addEventListener("click", () => {
                apiOutput.textContent = `Values: [${apiRange.values.join(", ")}]`;
            });

            setValuesBtn.addEventListener("click", () => {
                const val1 = Math.round(Math.random() * 500);
                const val2 = Math.round(Math.random() * 500);
                apiRange.setRangeValue(0, Math.min(val1, val2));
                apiRange.setRangeValue(1, Math.max(val1, val2));
                apiOutput.textContent = `Set to: [${apiRange.values.join(", ")}]`;
            });
        }
    }

    /**
     * Fetches the HTML for all examples, injects them into the page,
     * and then initializes the interactive scripts and syntax highlighting.
     */
    async function loadExamples() {
        const container = document.querySelector('.sections-container');
        if (!container) return;

        container.innerHTML = `<p class="loading-message">Loading examples...</p>`;

        // The order of files in this array determines their order on the page.
        const exampleFiles = [
            'examples/01-dual-handle-base.html',
            'examples/02-interactive-price-range.html',
            'examples/03-step-between.html',
            'examples/04-multi-handle-temperature.html',
            'examples/05-floating-tooltip.html',
            'examples/06-datalist-integration.html',
            'examples/07-budget-allocator.html',
            'examples/08-classic-look.html',
            'examples/09-javascript-api.html',
            'examples/10-custom-ticks.html',
            'examples/11-styled-timeline.html',
            'examples/12-multiphase-process.html'
        ];

        try {
            const fetchPromises = exampleFiles.map(file => fetch(file).then(res => {
                if (!res.ok) throw new Error(`Failed to load ${file}: ${res.statusText}`);
                return res.text();
            }));

            const examplesHtml = await Promise.all(fetchPromises);
            container.innerHTML = examplesHtml.join('');

            // Now that HTML is in the DOM, initialize scripts and syntax highlighting
            initializeInteractiveExamples();

            // Prism is loaded from CDN, so it's on the window object
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        } catch (error) {
            console.error("Error loading examples:", error);
            container.innerHTML = `<p class="error-message">Could not load examples. Please check the console for details.</p>`;
        }
    }

    document.addEventListener("DOMContentLoaded", loadExamples);
</script>
</body>
</html>